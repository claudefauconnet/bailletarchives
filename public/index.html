<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Archives Baillet</title>
    <link rel="icon" href="./images/logoATD.png">
    <link rel="stylesheet" media="screen" type="text/css" title="Design" href="js/jquery/jquery-ui.min.css"/>
    <link rel="stylesheet" href="js/jsTree/themes/default/style.min.css"/>


    <script src="js/jquery/jquery.min.js"></script>
    <script src="js/jquery/jquery-ui.min.js"></script>
    <script src="js/async.js"></script>


    <!--
    <link rel="stylesheet" type="text/css"
          href="https://cdn.datatables.net/v/dt/dt-1.10.18/b-1.5.4/b-colvis-1.5.4/b-html5-1.5.4/b-print-1.5.4/fc-3.2.5/fh-3.1.4/r-2.2.2/sc-1.5.0/sl-1.2.6/datatables.min.css"/>

    <script type="text/javascript"
            src="https://cdn.datatables.net/v/dt/dt-1.10.18/b-1.5.4/b-colvis-1.5.4/b-html5-1.5.4/b-print-1.5.4/fc-3.2.5/fh-3.1.4/r-2.2.2/sc-1.5.0/sl-1.2.6/datatables.min.js"></script>

-->
    <script src="js/dataTable.js"></script>
    <link rel="stylesheet" type="text/css" href="js/DataTables/datatables.min.css"/>

    <script type="text/javascript" src="js/DataTables/datatables.min.js"></script>


    <script src="js/jsTree/treeController.js"></script>

    <script src="js/recordController.js"></script>


    <script src="js/_versement.js"></script>
    <script src="js/_sortie.js"></script>
    <script src="js/_tablette.js"></script>
    <script src="js/_boite.js"></script>

    <script src="js/mainController.js"></script>
    <script src="js/statistics.js"></script>
    <script src="js/tools.js"></script>

    <script src="js/listController.js"></script>
    <script src="js/config.js"></script>
    <script src="js/context.js"></script>
    <script src="js/util.js"></script>


    <script src="js/magasinD3.js"></script>


   <!-- le nom authentication ne fonctionne pas avec nginx !!!-->
    <script src="js/authentification.js"></script>

    <script src="js/d3/d3.js"></script>
    <script src="js/d3/svg-pan-zoom.min.js"></script>

    <script src="https://d3js.org/d3-selection-multi.v1.min.js"></script>

    <style>
        body {
            font-family: Verdana;
            font-size: 14px;
        }

        input, button {
            margin: 5px;
            padding: 2px;
            width: 100px;

        }

        button {
            width: inherit;
            margin: 3px;
            padding: 3px;
            font-size: 12px;
        }

        .locateButton {
            background-color: #efec9f;
        }

        input {
            width: 150px;
        }

        input[type='checkbox'] {
            width: 30px;
        }

        #main {
            width: 100%;
            display: table
        }

        #left {
            float: left;
            display: inline;
            width: 20%;
        }

        #right {
            float: left;
            display: inline;
            width: 77%;
            margin-left: 5px;
        }

        .accordionInnerDiv {
            min-height: 300px;
            background-color: #9ca7b3;
            background-color: snow;

        }

        .ui-accordion-content {
            padding: 3px  !important;
        }

        #mainDiv, #linkedRecordsDiv {

            overflow: auto;

        }

        #mainDiv {
            border: #0a6aa1;
            border-width: 2px;
            border-style: solid;
        }

        .myDatatableAA {
            width: 600px;
            height: 200px;

        }

        .myDatatable td {
            border-bottom-style: solid;
            border-bottom-width: 1px;
            border-bottom-color: #93aeca;
            border-left-style: solid;
            border-left-width: 1px;
            border-left-color: #93aeca;
            width: 100px;

            height: 20px !important;
        }

        div.dataTables_wrapper {
            margin: 5px;

        }

        .dt-buttons {
            left: 200px;
            position: relative;
        }

        .dataTables_paginate {
            font-weight: bold;
        }

        .datatable tr {
            height: 20px;
        }

        .message {
            font-style: italic;
        }

        .searchCriteria {
            background-color: white;
            border-radius: 5px;
            padding: 2px;
            margin: 2px;
            font-size: 10px;
            color: #0a6aa1;
        }

        .dialogTab {

            background-color: #c2beff85;
        }

        #dialogDiv, .ui-dialog-buttonpane {

            background-color: #93aeca;
        }

        .selected {
            background-color: #0a6aa1;
        }

        .title {
            font-weight: bold;
            font-size: 18px;
            color: #0a6aa1;

        }

        #recordMessageSpan {

            font: bold 14px Serif;
            color: red;
        }

        /*   table thead th {
               transform: rotate(-45deg);
               transform-origin: top left;
           }

           .table-scrollable{
               overflow: visible;
           }*/

        div.dt-buttons {
            float: left;
        }

        .ui-accordion-header {
            font-weight: bold;
            color: #0a6aa1;
        }

        #popupD3Div {
            visibility: hidden;
            position: absolute;
            background-color: #ddd;
            margin: 3px;
            padding: 3px;
            border-style: solid;
            border-width: 1px;
        }

        #dialogContentDiv {

        }

        #dialogD3 {
            background-color: #ddd;
            margin: 3px;
            padding: 3px;
            width: 500px;
            height: 500px;
        }

        #magasind3MouseInfo {

            font-style: italic;
            font-size: 14px;
            padding: 3px;

        }

        #messageSpan {
            color: #003eff;
            font-weight: bold;
        }

        .alignCenterFlex0 {
            display: flex;
            align-content: center
        }


    </style>
    <style>
        #recordDiv {
            display: flex;
            flex-direction: row;
            width: 800px;

        }

        .recordDetailsDiv {

            margin: 10px;
            padding: 10px;
            background-color: #e9e9e9;
            border: #261803 solid 2px;
            border-radius: 10px;
            display: block;
        }

        .recordLinkedDiv {
            width: 500px;
            height: 200px;
            background-color: #e9e9e9;
            border: #261803 solid 2px;
            border-radius: 10px;
            display: block;
            overflow: auto;

        }

        #recordLinkedDivs {

            background-color: #d3f4f2e3;
            max-height: 800px;

            border: #261803 solid 2px;
            border-radius: 10px;
            display: flex;
            margin: 10px;
            padding: 10px;
            margin-bottom: 40px;
            flex-direction: column;

        }

        .dialogButton {
            margin-right: 400px !important;
        }

        .field-mandatory {
            font-weight: bold;
            background-color: #f1d3c7;

        }

        .field-mandatoryOnNew {
            font-weight: bold;
            background-color: #f1d3c7;

        }


    </style>

    <script>
        var dialog, dialog2, dialog3;
        $(function () {

            mainController.setDivsSize();
            $("#leftAccordion").accordion({

                activate: function (event, ui) {
                    var content = ui;
                    var tabName = ui.newHeader.text()
                    mainController.onChangeMainAccordionTab(tabName);
                    $("#popupD3Div").css("visibility", "hidden")
                    $("#dialogD3").dialog("close");


                }

            });

            /* $("#tabs").tabs({
                 activate: function (event, ui) {
                     var index = ui.newTab.index();
                     if (index > 0) {
                         mainController.loadTab(index)
                     }

                 }
             });*/

            $("#magasinsDivTabs").tabs({
                activate: function (event, ui) {
                    var index = ui.newTab.index();
                    if (index > 0) {

                    }

                }
            });

            dialog = $("#dialogDiv").dialog({
                autoOpen: false,
                height: mainController.totalDims.h - 100,
                width: "100%",
                modal: true,


                /* buttons: {
                     Fermer: {
                       //  class: 'dialogButton',
                         text:" Fermer",
                        click: function () {

                             dialog.dialog("close");
                             $("#dialogD3").dialog("close");
                             if (context.redrawMagasinD3) {
                                 context.redrawMagasinD3 = null;
                               //  magasinD3.drawMagasins()
                             }

                         }
                     }
                 },*/
                close: function () {

                 //   $("#dialogDiv").dialog("close");
                    if (context.redrawMagasinD3) {
                        context.redrawMagasinD3 = null;
                        //  magasinD3.drawMagasins()
                    }
                    recordController.closeRecordDialog()

                    // allFields.removeClass("ui-state-error");
                }
            });
            dialog2 = $("#dialog2Div").dialog({
                autoOpen: false,
                height: mainController.totalDims.h * 1.0,
                width: "100%",
                modal: true,
                buttons: {
                    Fermer: function () {
                        dialog2.dialog("close");

                    }
                },
                close: function () {

                    // allFields.removeClass("ui-state-error");
                }
            });

            dialog3 = $("#dialog3Div").dialog({
                autoOpen: false,
                height: 500,
                width: "50%",
                modal: true,
                buttons: {
                    Fermer: function () {
                        dialog3.dialog("close");
                    }
                },
                close: function () {
                    // allFields.removeClass("ui-state-error");
                }
            });
            dialogD3 = $("#dialogD3").dialog({
                autoOpen: false,
                modal: false,
                position: {my: "left top", at: "left top", of: window},
                close: function () {
                    // allFields.removeClass("ui-state-error");
                }
            });


            /*$("#loginDialogDiv").dialog({
                autoOpen: false,
                modal: true,
                buttons: {
                    "OK": function () {
                        mainController.logon();
                    },
                    "Fermer": function () {
                        $(this).dialog("close");
                    }
                }
            });*/


            if (true) {

                authentication.init(true, function (err, result) {

                })
                /* $("#searchTableInput").attr("disabled", true)
                 $("#leftAccordion").css("opacity", 0.2);
                 $("#loginDialogDiv").dialog("open");*/
            }
            else {
                mainController.init0();
            }


        })

    </script>
</head>
<body>
<span id="messageDiv" class="message"></span><img src="images/waitAnimated.gif" id="waitImg" style="display: none;width: 15px">
<div id="main">

    <div id="left">

        <div id="leftAccordion">
            <h1>Accueil</h1>
            <div id="acceuilDiv" class="accordionInnerDiv"
                 style="display: flex;flex-direction:column;align-content: center;align-items: center">
                <B>Bienvenue aux archives du centre Joseph Wrésinski</B>
                <img src="images/logoATD.png" width="100px">
                <br>
                <div id="magasinD3MessageDiv"></div>
            </div>

            <!--   <h1>Magasins</h1>
               <div id="MagasinsDiv" class="accordionInnerDiv">
                   <div id="searchDiv-Magasins"></div>
               </div>
   -->

            <h1>Versements</h1>
            <div id="versementsDiv" class="accordionInnerDiv">
                <div id="searchDiv-Versements"></div>

            </div>


            <h1>Sorties</h1>
            <div id="sortiesDiv" class="alignCenterFlex">
                <button onclick="Sortie.create()">Creer</button>
                <br>
                <button onclick="Sortie.listActives()">Lister en cours</button>
                <br>
                <button onclick="Sortie.listHistory()">Lister historique</button>
                <br>


            </div>


            <h1>Magasins</h1>

            <div id="magasinDiv" class="alignCenterFlex">

                <div>

                    <button onclick=" $('#operationTabletteSelect').append(Tablette.getOperationSelectOptions({prompt:1}))"> Actions Tablette</button><span id="currentMainMenuTabletteSpan"></span>
                    <br> <select id="operationTabletteSelect" onchange="Tablette.onTabletteOperationSelect(this)"></select>

                </div>

                <div id="searchDiv-Magasin"></div>

                <div>
                    <button onclick="Boite.locate()">Localiser Boite</button><span id="currentMainMenuBoiteSpan"></span>
                </div>
            </div>

            <h1>Gestion tables</h1>
            <div id=autresDiv" class="alignCenterFlex">
                <table align="center">
                    <tr>
                        <td>
                            table
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <select id="searchTableInput" size="5"></select>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            <div id="searchDiv-Autres"></div>
                        </td>
                    </tr>
                </table>
            </div>


            <h1>Outils</h1>
            <div id="tooldsDiv" class="accordionInnerDiv">

                <select id="toolsSelect" size="10" style="left: -30px;position: relative;">
                </select>

            </div>


            <h1>Statistiques</h1>
            <div id="statsDiv" class="accordionInnerDiv">
                <select id="statsSelect" size="10" style="left: -30px;position: relative;">

                </select>

            </div>

        </div>

    </div>

    <div id="right">
        <!--   <button id="showHideLeftPanelButton"><< >></button>-->
        <div id="mainDiv" class="dataTableDiv">


        </div>
        <div id="graphWrapperDiv" style="position: absolute;top:0px">
            <div style="display:flex;justify-content: center">
                <img src="images/photoBaillet.jpg">
            </div>

        </div>

        <div id="listWrapperDiv" class="dataTableDiv" style="position: absolute;top:0px">


        </div>

    </div>

    <div id="dialogDiv"></div>
    <div id="dialog2Div">
        <select id="linkedRecordsFieldSelect"></select></select><input id="searchLinkedRecordsInput">
        <button id="searchLinkedRecordsButton">chercher</button>
        <button id="addLinkedRecordButton">ajouter lien</button>
        <div id="new_linkedRecordsDiv" class="dataTableDiv"></div>
    </div>

    <div id="dialog3Div">

    </div>


    <div id="popupD3Div">
        <div id="dialogContentDiv"></div>
    </div>

    <div id="dialogD3"></div>

    <div id="movableSearchDiv" style="display: none">
        <table>
            <tr>
                <td>
                    <button id="addRecordButton" style="width:60px">Ajouter</button>&nbsp;
                </td>
            </tr>
            <tr>
                <td>
                    champ
                </td>
            </tr>
            <tr>
                <td>
                    <select id="searchColumnInput"></select>
                </td>
            </tr>

            <tr>
                <td>
                    <select id="searchOperatorInput"></select> <input id="searchValueInput"
                                                                      style="width:100px"/>
                </td>
            </tr>

            <tr>
                <td>

                    <button id="andSearchButton" style="width:20px"> +</button>
                    <img src='images/clear.png' style="vertical-align: middle" width='20px'
                         onclick='listController.removeSearchCriteria(-1)'>
                    <br>
                    <button id="searchButton"> Lister</button>
                    <button id="locateButton" class="locateButton"> Localiser</button>


                </td>
            </tr>
            <tr>
                <td>
                    <div id="searchCriteriaDiv">


                    </div>
                </td>
            </tr>
        </table>
    </div>
    <div id="loginDiv"
         style="position: absolute;visibility: hidden;display: flex;justify-content:center;align-items: center">
        <div> login<input id="loginInput">
            password<input type="password" id="passwordInput" onkeydown="if (event.keyCode == 13)
                        document.getElementById('loginButton').click()">
            <button id="loginButton" onclick="authentication.doLogin()">OK</button>
            <button id="xxx" onclick="Tablette.updateCotesParTabletteZeros()">TEST boites</button>

            <div id="loginMessage"></div>
        </div>
    </div>
</body>
</html>